# NHS智能提醒系统 - 配置说明

## 🚀 一键启动使用方法

### 第1步：启动系统
```bash
start_production.bat
```

### 第2步：首次配置（仅需一次）
系统会自动创建 `.env` 配置文件，请编辑并填入以下信息：

```env
# WhatsApp API配置（必需）
WHATSAPP_ACCESS_TOKEN=你的访问令牌
WHATSAPP_PHONE_NUMBER_ID=你的电话号码ID
WHATSAPP_WEBHOOK_URL=https://你的域名.com/webhook
WHATSAPP_BUSINESS_NAME=NHS等候列表提醒服务

# 数据库配置（可选，有默认值）
DATABASE_URL=sqlite:///nhs_alerts.db

# 系统配置（可选，有默认值）
API_PORT=8001
LOG_LEVEL=INFO
```

### 第3步：重新启动
配置完成后，再次运行 `start_production.bat` 即可启动所有功能。

## 📱 系统功能

### ✅ 已集成的所有功能
- **Web管理界面**: http://localhost:8001
- **WhatsApp智能对话**: 4屏设置流程 + 自然语言查询
- **8种智能提醒**: 阈值、变化、替代方案、异常、预测等
- **GP预约监控**: 5分钟间隔实时监控 + 即时通知
- **NHS数据ETL**: 实时数据抓取和处理
- **多渠道通知**: WhatsApp + 邮件 + SMS

### 🎯 用户使用方式

#### WhatsApp命令
```
setup   - 开始设置偏好
status  - 查看当前状态
alerts  - 查看最近提醒
trends  - 查看趋势分析
help    - 显示帮助信息
stop    - 取消订阅
```

#### 自然语言查询
```
"心脏科等候时间多久？"
"我附近有更快的选择吗？"
"本周等候时间有变化吗？"
```

## 🔧 WhatsApp API获取方法

### 1. 创建Meta开发者账号
- 访问：https://developers.facebook.com/
- 注册并创建新应用
- 添加"WhatsApp Business API"产品

### 2. 获取API凭据
- **Access Token**: 在应用设置中生成永久令牌
- **Phone Number ID**: 在WhatsApp配置中获取
- **Webhook URL**: 你的公网HTTPS地址

### 3. 配置Webhook
- 回调URL：https://你的域名.com/webhook
- 验证令牌：可以使用默认值
- 订阅事件：messages, message_deliveries

## 🗂️ 核心文件结构

```
prod_final/
├── start_production.bat        # 🎯 主启动脚本（唯一入口）
├── main.py                     # 核心系统入口
├── .env                        # 配置文件（自动生成）
├── whatsapp_simple_config.env  # 配置模板
├── 简化配置说明.md             # 中文配置说明
├── 
├── # 核心功能模块
├── whatsapp_flow_service.py    # WhatsApp智能对话服务
├── intelligent_alert_engine.py # 智能提醒引擎
├── gp_slot_monitor.py          # GP预约监控
├── nhs_complete_system.py      # NHS完整系统集成
├── 
├── # 配置和数据
├── whatsapp_config.py          # WhatsApp配置类
├── data_sources.py             # 数据源配置
├── create_db.sql               # 数据库初始化
├── nhs_alerts.db               # 系统数据库
└── requirements.txt            # Python依赖
```

## 🎯 使用流程

1. **首次使用**：运行 `start_production.bat` → 自动创建配置 → 编辑 `.env` → 重启
2. **日常使用**：双击 `start_production.bat` → 系统自动启动所有功能
3. **用户访问**：Web界面 http://localhost:8001 + WhatsApp消息

## 🔍 故障排除

### 配置问题
- 检查 `.env` 文件是否存在
- 验证WhatsApp API凭据是否正确
- 确认Webhook URL使用HTTPS

### 启动问题
- 确保Python已安装
- 检查端口8001是否被占用
- 查看控制台错误信息

### 功能问题
- Web界面正常但WhatsApp无响应：检查Webhook配置
- 数据库错误：删除 `nhs_alerts.db` 让系统重新创建
- 网络问题：检查NHS API访问权限

---

**🎉 完成后，您将拥有一个完整的生产级NHS智能提醒系统！** 